# js


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## State Initialization

Generates the JS state object for a Web Audio manager instance.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L14"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_state_init

``` python

def generate_state_init(
    config:WebAudioConfig, # Instance configuration
)->str: # JS code that initializes the state object

```

*Generate JS code to initialize the namespaced state object.*

## Init Audio

Reads audio URLs from a hidden input, fetches all files, and decodes
them in parallel via `Promise.all()`.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L41"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_init_audio

``` python

def generate_init_audio(
    config:WebAudioConfig, # Instance configuration
)->str: # JS init function

```

*Generate JS function that loads and decodes audio files in parallel.*

## Stop Audio

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L110"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_stop_audio

``` python

def generate_stop_audio(
    config:WebAudioConfig, # Instance configuration
)->str: # JS stop function

```

*Generate JS function that stops current playback.*

## Play Segment

Plays a time range from a specific audio buffer. Supports optional
playback speed and auto-navigate.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L131"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_play_segment

``` python

def generate_play_segment(
    config:WebAudioConfig, # Instance configuration
    nav_down_btn_id:str='', # Nav down button ID (for auto-navigate)
)->str: # JS play function

```

*Generate JS function that plays a segment from a specific buffer.*

## Optional Features

Speed control, replay, and auto-navigate functions generated only when
enabled.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L212"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_optional_features

``` python

def generate_optional_features(
    config:WebAudioConfig, # Instance configuration
)->str: # JS for optional feature functions (empty if none enabled)

```

*Generate JS for optional features based on config flags.*

## Focus Change Callback

Card-stack-compatible callback triggered on focus changes. Reads data
attributes from the card element to determine which buffer and time
range to play.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L244"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_focus_change

``` python

def generate_focus_change(
    config:WebAudioConfig, # Instance configuration
    focus_input_id:str, # Hidden input ID for focused index
)->str: # JS focus change callback

```

*Generate JS focus change callback for card stack integration.*

## HTMX AfterSettle Handler

Re-attaches after each card swap to trigger focus change callback when
navigation completes.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L293"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_htmx_settle_handler

``` python

def generate_htmx_settle_handler(
    config:WebAudioConfig, # Instance configuration
    card_stack_id:str, # Card stack container ID
)->str: # JS HTMX afterSettle handler

```

*Generate HTMX afterSettle handler for card stack navigation.*

## Full Script Assembly

Combines all JS parts into a single string.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-web-audio/blob/main/cjm_fasthtml_web_audio/js.py#L328"
target="_blank" style="float:right; font-size:smaller">source</a>

### generate_web_audio_js

``` python

def generate_web_audio_js(
    config:WebAudioConfig, # Instance configuration
    focus_input_id:str, # Hidden input ID for focused index
    card_stack_id:str, # Card stack container ID
    nav_down_btn_id:str='', # Nav down button ID (for auto-navigate)
)->str: # Complete JS code for this instance

```

*Generate the complete Web Audio API JS for a configured instance.*

## Tests

``` python
# Test basic config generates expected function names
cfg = WebAudioConfig(namespace="test", indicator_selector=".test-indicator")
js = generate_web_audio_js(cfg, focus_input_id="test-focus", card_stack_id="test-cs")

assert "window._webAudio_test" in js
assert "window.initTestAudio" in js
assert "window.stopTestAudio" in js
assert "window.playTestSegment" in js
assert "window.onTestFocusChange" in js
assert "sd-test-audio-urls" in js
assert "Promise.all" in js

# No optional features by default
assert "setTestSpeed" not in js
assert "replayTestSegment" not in js
assert "setTestAutoNavigate" not in js
print("Basic config test passed")
```

    Basic config test passed

``` python
# Test full-featured config
cfg2 = WebAudioConfig(
    namespace="review",
    indicator_selector=".review-playing-indicator",
    enable_speed=True, enable_replay=True, enable_auto_nav=True,
)
js2 = generate_web_audio_js(
    cfg2, focus_input_id="review-focus", card_stack_id="review-cs",
    nav_down_btn_id="review-nav-down",
)

assert "window._webAudio_review" in js2
assert "window.setReviewSpeed" in js2
assert "window.replayReviewSegment" in js2
assert "window.setReviewAutoNavigate" in js2
assert "playbackSpeed" in js2
assert "review-nav-down" in js2
assert "autoNavigate" in js2
print("Full-featured config test passed")
```

    Full-featured config test passed
